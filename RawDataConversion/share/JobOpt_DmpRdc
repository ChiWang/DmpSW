#! /usr/bin/python
'''
 *  $Id: JobOpt_DmpRdc, 2014-04-16 14:30:51 chi $
 *  Author(s):
 *    Chi WANG (chiwang@mail.ustc.edu.cn) 11/03/2014
 *-----------------------------------------------------
 *          Example of how to run Rdc of DAMPE
 *-----------------------------------------------------
'''

#-------------------------------------------------------------------
# Load lib. of DAMPE software
import os
import sys
prefix=os.getenv('DMPSWSYS')
if os.environ['DMPSWSYS'] not in sys.path:
    sys.path.append(prefix+'/lib')

import libDmpCore as DmpCore
import libDmpRdc as  DmpRdc

#-------------------------------------------------------------------
# Create Service
rdcDataMgr = DmpRdc.DmpRdcSvcDataMgr()
rdcDataMgr.Set("OutDataPath","./test")      # where to save the output. If NOT set will use "./" by defualt

#-------------------------------------------------------------------
# Create Algorithm
rdcAlgHed = DmpRdc.DmpRdcAlgHeader("RdcAlgHeader")
rdcAlgPsd = DmpRdc.DmpRdcAlgPsd("RdcAlgPsd")
rdcAlgNud = DmpRdc.DmpRdcAlgNud("RdcAlgNud")
rdcAlgBgo = DmpRdc.DmpRdcAlgBgo("RdcAlgBgo")
rdcAlgStk = DmpRdc.DmpRdcAlgStk("RdcAlgStk")

#-------------------------------------------------------------------
# RUN DmpCore
    ##  Service Manager
gDmpSvcMgr = DmpCore.DmpServiceManager.GetInstance()
gDmpSvcMgr.Append(rdcDataMgr)
gDmpSvcMgr.Initialize()
    ##  Algorithm Manager
gDmpAlgMgr = DmpCore.DmpAlgorithmManager.GetInstance()
gDmpAlgMgr.Append(rdcAlgPsd)
gDmpAlgMgr.Append(rdcAlgStk)
gDmpAlgMgr.Append(rdcAlgBgo)
gDmpAlgMgr.Append(rdcAlgNud)
gDmpAlgMgr.Initialize()

# Set options for this job
rdcOpt = DmpRdc.DmpRdcSvcOption.GetInstance()
    ##  where to read cnct files for different subDet
rdcOpt.Set("cnctPath",DmpCore.DmpEDetectorID.kPsd,prefix+"/share/Connector/Psd/Quarter")
#rdcOpt.Set("cnctPath",DmpCore.DmpEDetectorID.kStk,prefix+"/share/Connector/Stk/Quarter")     # if NOT set, will skip setupconnector and conversion methods of this subDet.
rdcOpt.Set("cnctPath",DmpCore.DmpEDetectorID.kBgo,prefix+"/share/Connector/Bgo/Quarter")
rdcOpt.Set("cnctPath",DmpCore.DmpEDetectorID.kNud,prefix+"/share/Connector/Nud/Quarter")
    ##  where to save the output of this job. If NOT set will use "./" by defualt
rdcOpt.Set("outDataPath",DmpCore.DmpEDetectorID.kWhole,"./test")

#-------------------------------------------------------------------
# Run job
    ##  Start to run this job (Execute()). Also could use Set("outDataPath") between 2 Execute()
DmpRdc.Execute(prefix+"/share/TestRelease/Ex_ScienceData_20121005164959.dat")
#print rdcOpt.Get("outDataName")
#rdcOpt.Set("outDataNote",DmpCore.DmpEDetectorID.kWhole,"ProTest")   # set tag for the next output data. NOT set is okay
#DmpRdc.Execute(prefix+"/share/TestRelease/Ex_ScienceData_20121005164959.dat")
#print rdcOpt.Get("outDataName")

#-------------------------------------------------------------------
# Quit DmpCore
gDmpAlgMgr.Finalize()


